@using Microsoft.AspNetCore.Http
@using ReviewSocial.Repositories
@model IEnumerable<Post>
@inject ICategoryRepository ICategoryRepository;


@{
    var categories = ICategoryRepository.GetAll();
}
@{
    ViewData["Title"] = ViewBag.Category.Name;
}

<link href="~/lib/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<div class="container">
    <div class="row">
        <div class="col-lg-8 activity p-2">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-transparent p-0">
                    <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
                    <li class="breadcrumb-item"><a href="#">@ViewBag.Category.Name</a></li>
                </ol>
                @*<div>
                    <p style="font-family:'Times New Roman', Times, serif">Chuyên mục - ReviewBeauty</p>
                </div>*@
            </nav>

            @if (Model != null)
            {
                @foreach (var item in Model.Where(i => i.Status == true))
                {
                    <div class="panel panel-default mb-3 bg-white p-2 rounded-3" id="post-@item.Id">
                        <div class="panel-heading">
                            <img src="@(item.User.Avatar == null ? "/img/avatar.jpg" : "/img/" + item.User.Avatar)" class="img-rounded">
                            <div class="pull-right text-right">
                                @if (@User.Identity.Name == @item.User.Username)
                                {
                                <div class="dropdown">
                                    @*<div class="card-text" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></div>*@
                                    <button class="btn btn-secondary bg-transparent text-dark border-0" type="button" data-toggle="dropdown" aria-expanded="false">
                                        <i class="fa fa-ellipsis-h"></i>
                                    </button>
                                    <div class="dropdown-menu" style="margin-left: -155px;">
                                       
                                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#exampleModal"><i class="fa fa-pencil" aria-hidden="true"></i> Chỉnh sửa bài viết</a>
                                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#deletePostModal" onclick="getPostId(@item.Id)"><i class="fa fa-trash" aria-hidden="true"></i> Xóa bài</a>
                                            <a class="dropdown-item" href="#" onclick="hidenPost(@item.Id)"><i class="fa fa-window-close" aria-hidden="true"></i> Ẩn bài viết</a>
                                      
                                        
                                    </div>
                                </div>
                                }
                            </div>
                            <div><strong>@item.User.Username</strong></div>
                        </div>
                        <div class="panel-body">
                            <div class="text-center">
                                <img src="@(item.Thumbnail == null ? "/img/logo.jpg" : "/img/posts/" + item.Thumbnail)" class="img-responsive w-50">
                            </div>
                            <div class="card-body text-center">
                                <a href="/post/details/@item.Id" class="card-text">@item.Title</a>
                            </div>
                            <div class="actions">
                                <div class="btn-group">
                                  @*  <button type="button" class="btn btn-link"><i class="fa fa-thumbs-o-up"></i> Like</button>*@
                                    <button type="button" class="btn btn-link"><i class="fa fa-comments"></i> Comment</button>
                                </div>
                                <div class="pull-right"><strong>@item.View</strong> People View this</div>
                            </div>

                        </div>
                    </div>
                }
            }
        </div>
    
                <div class="col-md-4">
                    <div class="card mb-3 border-0">
                        <div class="card-header bg-primary text-white pt-2 pb-1">
                            <h5>Tin hot</h5>
                        </div>
                @if (Model != null)
                {
                    @foreach (Post item in ViewBag.Posts)
                    {
                        <div class="card border-0 mt-2">
                            <div class="row no-gutters">
                                <div class="col-md-4">
                                    <img src="@(item.Thumbnail == null ? "/img/logo.jpg" : "/img/posts/" + item.Thumbnail)" class="card-img-top">
                                   @* <img src="~/img/service-1.jpg" class="card-img-top" alt="Hình ảnh">*@
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body p-0 pl-2">
                                        <a href="/post/details/@item.Id" class="card-title">@item.Title</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                      </div>
                 </div>

    </div>
    <div class="row justify-content-center">
        <div class="col-lg-8 activity p-2">
            <nav aria-label="Page navigation">

                <ul class="pagination">
                    <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">Next</a></li>
                </ul>

            </nav>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <form action="#" method="">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Tạo bài viết</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group row mb-3">
                        <label for="title" class="col-sm-2 col-form-label">Tiêu đề:</label>
                        <div class="col-sm-10">
                            <input type="text" name="title" class="form-control" id="title" value="" placeholder="Tiêu đề">
                            <span id="error-title"></span>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label for="title" class="col-sm-2 col-form-label">Danh mục:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="category">
                                @foreach (var category in categories as List<Category>)
                                {
                                    <option value="@category.Id">@category.Name</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label for="inputPassword" class="col-sm-2 col-form-label">Nội dung:</label>
                        <div class="col-sm-10">
                            <textarea name="content" id="content-home" class="form-control w-100" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="form-group row mb-3">
                        <label for="exampleFormControlFile1" class="col-sm-2 col-form-label">Ảnh bài viết:</label>
                        <div class="col-sm-10">
                            <input type="file" name="file" class="form-control-file" id="file">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="btnCloseModal" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnSubmit" value="add">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>
@*- Modal xóa -->*@
<div class="modal fade" id="deletePostModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel" style="color:black">Xác nhận xóa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa bài viết này?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnCloseModalDelete" class="btn btn-secondary" data-dismiss="modal" onclick="closeModal()">Hủy</button>
                <button type="button" id="btnDeletePost" class="btn btn-danger" onclick="deletePostWithModal()">Xóa</button>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script src="~/js/post.js"></script>
}